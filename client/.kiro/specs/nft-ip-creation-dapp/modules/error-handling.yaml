module_name: "Error Handling"
version: "1.0.0"
description: "Comprehensive error handling for failed transactions, retries, and user notifications"

dependencies:
  - transaction_monitor
  - notification_system
  - retry_queue
  - logging_service

inputs:
  error_events:
    type: "object"
    properties:
      error_type:
        type: "string"
        enum: ["TRANSACTION_FAILED", "NETWORK_ERROR", "VALIDATION_ERROR", "CONTRACT_ERROR", "WALLET_ERROR"]
      error_code:
        type: "string"
      message:
        type: "string"
      context:
        type: "object"
        properties:
          transaction_hash:
            type: "string"
            optional: true
          user_wallet:
            type: "string"
          operation:
            type: "string"
          timestamp:
            type: "string"
            format: "datetime"
          stack_trace:
            type: "string"
            optional: true
      severity:
        type: "string"
        enum: ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
      retry_count:
        type: "number"
        default: 0

outputs:
  error_response:
    type: "object"
    properties:
      user_message:
        type: "string"
        description: "User-friendly error message"
      error_id:
        type: "string"
        description: "Unique error identifier for tracking"
      retry_available:
        type: "boolean"
      suggested_actions:
        type: "array"
        items:
          type: "string"
      support_contact:
        type: "object"
        properties:
          show_contact: 
            type: "boolean"
          contact_info:
            type: "string"
  
  retry_strategy:
    type: "object"
    properties:
      should_retry:
        type: "boolean"
      retry_delay:
        type: "number"
        description: "Delay in milliseconds"
      max_retries:
        type: "number"
      retry_conditions:
        type: "array"
        items:
          type: "string"

workflow_steps:
  error_detection:
    1: "Monitor transaction status"
    2: "Catch application exceptions"
    3: "Validate API responses"
    4: "Check network connectivity"
    5: "Monitor contract interactions"
  
  error_classification:
    1: "Determine error type"
    2: "Assess error severity"
    3: "Check if error is retryable"
    4: "Extract relevant context"
    5: "Generate error ID"
  
  error_handling:
    1: "Log error details"
    2: "Determine retry strategy"
    3: "Generate user-friendly message"
    4: "Update UI state"
    5: "Queue retry if applicable"
    6: "Send notifications if needed"
  
  recovery_process:
    1: "Execute retry logic"
    2: "Monitor retry attempts"
    3: "Update retry count"
    4: "Handle final failure"
    5: "Escalate if necessary"

frontend_error_handling:
  ui_error_states:
    transaction_failed:
      display: "error_modal"
      message: "Transaction failed. Please try again."
      actions: ["Retry", "Cancel"]
      icon: "exclamation_triangle"
    
    network_error:
      display: "toast_notification"
      message: "Network connection lost. Retrying..."
      actions: ["Dismiss"]
      auto_dismiss: 5000
    
    validation_error:
      display: "inline_field_error"
      message: "Please check your input and try again"
      actions: ["Fix Input"]
      highlight_fields: true
    
    wallet_error:
      display: "error_banner"
      message: "Wallet connection issue. Please reconnect."
      actions: ["Reconnect Wallet"]
      persistent: true
  
  error_boundaries:
    - component: "NFTCreationForm"
      fallback: "ErrorFallback"
      recovery: "Reset Form"
    
    - component: "Dashboard"
      fallback: "DashboardError"
      recovery: "Reload Data"
    
    - component: "App"
      fallback: "GlobalError"
      recovery: "Reload Page"

backend_error_handling:
  api_error_responses:
    400:
      type: "VALIDATION_ERROR"
      format:
        success: false
        error:
          code: "VALIDATION_FAILED"
          message: "Request validation failed"
          details: {}
    
    429:
      type: "RATE_LIMIT_ERROR"
      format:
        success: false
        error:
          code: "RATE_LIMIT_EXCEEDED"
          message: "Too many requests"
          retry_after: 60
    
    500:
      type: "INTERNAL_ERROR"
      format:
        success: false
        error:
          code: "INTERNAL_SERVER_ERROR"
          message: "An unexpected error occurred"
          error_id: "uuid"
  
  retry_mechanisms:
    transaction_retry:
      max_attempts: 3
      backoff_strategy: "exponential"
      base_delay: 2000
      conditions:
        - "network_timeout"
        - "gas_price_too_low"
        - "nonce_too_low"
    
    api_retry:
      max_attempts: 5
      backoff_strategy: "linear"
      base_delay: 1000
      conditions:
        - "temporary_network_error"
        - "rate_limit_exceeded"
        - "service_unavailable"

error_scenarios:
  transaction_errors:
    insufficient_funds:
      error_code: "INSUFFICIENT_FUNDS"
      user_message: "Insufficient funds for gas. Please add ETH to your wallet."
      suggested_actions:
        - "Add funds to wallet"
        - "Try with lower gas price"
      retry_available: false
      severity: "MEDIUM"
    
    gas_limit_exceeded:
      error_code: "GAS_LIMIT_EXCEEDED"
      user_message: "Transaction requires more gas than available."
      suggested_actions:
        - "Increase gas limit"
        - "Try again later"
      retry_available: true
      severity: "MEDIUM"
    
    transaction_reverted:
      error_code: "TRANSACTION_REVERTED"
      user_message: "Transaction was reverted by the contract."
      suggested_actions:
        - "Check contract conditions"
        - "Verify input parameters"
      retry_available: true
      severity: "HIGH"
  
  network_errors:
    rpc_timeout:
      error_code: "RPC_TIMEOUT"
      user_message: "Network request timed out. Please try again."
      suggested_actions:
        - "Check internet connection"
        - "Try again in a moment"
      retry_available: true
      severity: "LOW"
    
    chain_disconnected:
      error_code: "CHAIN_DISCONNECTED"
      user_message: "Lost connection to blockchain. Reconnecting..."
      suggested_actions:
        - "Wait for reconnection"
        - "Refresh page if issue persists"
      retry_available: true
      severity: "MEDIUM"
  
  validation_errors:
    invalid_metadata:
      error_code: "INVALID_METADATA"
      user_message: "Please check your NFT details and try again."
      suggested_actions:
        - "Verify all required fields"
        - "Check image format and size"
      retry_available: false
      severity: "LOW"
    
    invalid_wallet_address:
      error_code: "INVALID_WALLET"
      user_message: "Invalid wallet address format."
      suggested_actions:
        - "Check wallet address format"
        - "Ensure address starts with 0x"
      retry_available: false
      severity: "LOW"

notification_system:
  channels:
    - type: "toast"
      for_errors: ["network_error", "temporary_failures"]
      position: "top_right"
      auto_dismiss: true
    
    - type: "modal"
      for_errors: ["transaction_failed", "critical_errors"]
      blocking: true
      requires_action: true
    
    - type: "banner"
      for_errors: ["wallet_disconnected", "maintenance_mode"]
      persistent: true
      dismissible: false
    
    - type: "inline"
      for_errors: ["validation_errors", "form_errors"]
      context_specific: true
      real_time: true

logging_and_monitoring:
  error_logging:
    log_level: "ERROR"
    include_stack_trace: true
    include_user_context: true
    structured_format: true
    
  metrics:
    - name: "error_rate_by_type"
      type: "counter"
      labels: ["error_type", "severity"]
    
    - name: "retry_success_rate"
      type: "histogram"
      labels: ["operation", "retry_count"]
    
    - name: "error_resolution_time"
      type: "histogram"
      labels: ["error_type"]
  
  alerting:
    - condition: "error_rate > 5% in 5 minutes"
      severity: "warning"
      notification: "slack_channel"
    
    - condition: "critical_errors > 0"
      severity: "critical"
      notification: "pager_duty"

example_data_structures:
  error_event:
    error_type: "TRANSACTION_FAILED"
    error_code: "INSUFFICIENT_FUNDS"
    message: "insufficient funds for gas * price + value"
    context:
      transaction_hash: null
      user_wallet: "0x742d35Cc6634C0532925a3b8D4C9db96590c6C87"
      operation: "createAndRegisterIP"
      timestamp: "2024-01-15T10:30:00Z"
      gas_required: 250000
      gas_available: 150000
    severity: "MEDIUM"
    retry_count: 0
  
  error_response:
    user_message: "Insufficient funds for gas. Please add ETH to your wallet."
    error_id: "err_1234567890abcdef"
    retry_available: false
    suggested_actions:
      - "Add ETH to your wallet"
      - "Check current gas prices"
      - "Try again with lower gas limit"
    support_contact:
      show_contact: true
      contact_info: "support@example.com"
  
  retry_strategy:
    should_retry: false
    retry_delay: 0
    max_retries: 0
    retry_conditions: []

recovery_procedures:
  automatic_recovery:
    - scenario: "temporary_network_error"
      action: "retry_with_backoff"
      max_attempts: 3
    
    - scenario: "gas_price_too_low"
      action: "increase_gas_price"
      multiplier: 1.2
    
    - scenario: "nonce_too_low"
      action: "refresh_nonce"
      retry_immediately: true
  
  manual_recovery:
    - scenario: "insufficient_funds"
      guidance: "Add funds to wallet and retry"
      help_link: "/help/adding-funds"
    
    - scenario: "contract_paused"
      guidance: "Contract is temporarily paused"
      help_link: "/help/contract-status"
  
  escalation_procedures:
    - condition: "retry_count > max_retries"
      action: "log_persistent_failure"
      notify: "development_team"
    
    - condition: "critical_error"
      action: "immediate_alert"
      notify: "on_call_engineer"